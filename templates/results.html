<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ML Bets - Results</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <!-- Navbar -->
  <nav>
    <div class="nav-left">Machine Learning Bets</div>
    <div class="nav-right">
      <a href="{{ url_for('index') }}">Home</a>
      <a href="{{ url_for('predictions') }}">Predictions</a>
      <a href="{{ url_for('results') }}">Results</a>
      <a href="{{ url_for('informations') }}">FAQ</a>
    </div>
  </nav>

  <!-- Header / Filter Section -->
  <header>
    <h1>Past Results</h1>
    <p class="date-range">
      Use filters to find specific leagues or high confidence picks.
    </p>

    <!-- Filters -->
    <div class="filters">
      <label for="league-select">League:</label>
      <select id="league-select">
        <option value="all" selected>All</option>
        {% for league_code in leagues %}
          <option value="{{ league_code }}">
            {{ league_names.get(league_code, league_code) }}
          </option>
        {% endfor %}
      </select>

      <label for="week-select">Week:</label>
      <select id="week-select">
        <option value="all" selected>All</option>
        {% for w in weeks %}
          <option value="{{ w }}">{{ w }}</option>
        {% endfor %}
      </select>

      <label for="high-conf">
        <input type="checkbox" id="high-conf">
        High Confidence
      </label>
    </div>
  </header>

  <!-- Cards Container -->
  <div class="cards-container" id="results-container">
    {% if results is not none and results.shape[0] > 0 %}
      {% for idx, p in results.iterrows() %}
        {# 
          Color-code card if BetCorrect = True => green, else red 
        #}
        {% set correctness_class = 'correct' if p['BetCorrect'] else 'wrong' %}

        <div 
          class="prediction-card {{ correctness_class }}"
          data-league="{{ p['Div'] }}"
          data-highconf="{{ p['High_conf'] }}"
          data-week="{{ p['Week'] }}"
        >
          <!-- Top row: Date, Weekday, Time -->
          <div class="card-top">
            <span>
              {% if 'Weekday' in p and p['Weekday'] %}
                {{ p['Weekday'] }}
              {% endif %}
              {% if p['Date'] %}
                {{ p['Date'].strftime('%d.%m.%Y') }}
              {% endif %}
              {% if 'Time' in p and p['Time'] %}
                {{ p['Time'] }}
              {% endif %}
            </span>
          </div>

          <!-- Middle: HomeTeam vs. AwayTeam -->
          <div class="card-middle">
            <div class="matchup">
              <span>{{ p['HomeTeam'] }} vs. {{ p['AwayTeam'] }}</span>
            </div>

            <!-- Show the final bet, final odd, confidence, etc. -->
            <div class="prediction-info">
              {% set final_bet = p['FinalBet'] %}
              {% set predicted_odd = 0 %}
              {% set predicted_prob = 0 %}

              {# 
                Decide final odd and final probability 
                based on the actual final bet 
              #}
              {% if final_bet == 'H' %}
                {% set final_bet = p['HomeTeam'] %}
                {% set predicted_odd = p['B365H'] if 'B365H' in p else 0 %}
                {% set predicted_prob = p['Prob_H'] %}
              {% elif final_bet == '1X' %}
                {% set final_bet = '1X' %}
                {% set predicted_odd = p['1X_odds'] if '1X_odds' in p else 0 %}
                {% set predicted_prob = p['Prob_H'] + p['Prob_D'] %}
              {% elif final_bet == 'A' %}
                {% set final_bet = p['AwayTeam'] %}
                {% set predicted_odd = p['B365A'] if 'B365A' in p else 0 %}
                {% set predicted_prob = p['Prob_A'] %}
              {% elif final_bet == 'X2' %}
                {% set final_bet = 'X2' %}
                {% set predicted_odd = p['X2_odds'] if 'X2_odds' in p else 0 %}
                {% set predicted_prob = p['Prob_D'] + p['Prob_A'] %}
              {% else %}
                {# Fallback if FinalBet is None or unknown #}
                {% set final_bet = '??' %}
                {% set predicted_odd = 0 %}
                {% set predicted_prob = 0 %}
              {% endif %}

              <!-- Output the final values -->
              <p>
                Prediction: 
                <span class="highlight">
                  {{ final_bet }} - {{ predicted_odd }}
                </span>
              </p>
              <p>
                Confidence: 
                <span class="highlight">
                  {{ (predicted_prob * 100)|round(1) }}%
                </span>
              </p>
              <p>
                Result:
                <span class="highlight">
                  {% if 'Score' in p and p['Score'] %}
                    {{ p['Score'] }}
                  {% else %}
                    (No Score)
                  {% endif %}
                </span>
              </p>
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p>No results found.</p>
    {% endif %}
  </div>

  <!-- JavaScript for filtering by league, week, and high confidence -->
  <script>
    const leagueSelect = document.getElementById('league-select');
    const weekSelect = document.getElementById('week-select');
    const highConfCheckbox = document.getElementById('high-conf');
    const cards = document.querySelectorAll('.prediction-card');

    function filterResults() {
      const selectedLeague = leagueSelect.value;
      const selectedWeek = weekSelect.value;
      const highConfOnly = highConfCheckbox.checked;

      cards.forEach(card => {
        const cardLeague = card.getAttribute('data-league');
        const cardWeek = card.getAttribute('data-week');
        const cardHighConf = card.getAttribute('data-highconf');

        let show = true;

        // Filter by league
        if (selectedLeague !== 'all' && cardLeague !== selectedLeague) {
          show = false;
        }

        // Filter by week
        if (selectedWeek !== 'all' && cardWeek !== selectedWeek) {
          show = false;
        }

        // Filter by high confidence
        if (highConfOnly && cardHighConf !== '1') {
          show = false;
        }

        card.style.display = show ? 'block' : 'none';
      });
    }
    highConfCheckbox.checked = true;
    
    leagueSelect.addEventListener('change', filterResults);
    weekSelect.addEventListener('change', filterResults);
    highConfCheckbox.addEventListener('change', filterResults);

    // Initial filter on page load
    filterResults();
  </script>

  <!-- Footer -->
  <footer>
    <div class="footer-content">
      <p>&copy; 2025 Machine Learning Bets</p>
      <p>This website is for educational purposes only</p>
      <p>No Prediction is guaranteed</p>
      <p>Contact: machinelearningbets@gmail.com</p>
    </div>
  </footer>

  <style>
    footer {
      background-color: #222;
      color: white;
      text-align: center;
      padding: 15px;
      margin-top: 30px;
    }
    .footer-links a {
      color: #ddd;
      text-decoration: none;
      margin: 0 10px;
    }
    .footer-links a:hover {
      color: #fff;
    }
  </style>
</body>
</html>
