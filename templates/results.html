<!-- templates/results.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ML Bets - Results</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <!-- Navbar -->
  <nav>
    <div class="nav-left">Machine Learning Bets</div>
    <div class="nav-right">
      <a href="{{ url_for('index') }}">Home</a>
      <a href="{{ url_for('predictions') }}">Predictions</a>
      <a href="{{ url_for('results') }}">Results</a>
      <a href="{{ url_for('informations') }}">FAQ</a>
    </div>
  </nav>

  <!-- Header / Filter Section -->
  <header>
    <h1>Past Results</h1>
    <p class="date-range">
      Use filters to find specific leagues or high confidence picks.
    </p>

    <!-- Filters -->
    <div class="filters">
      <label for="league-select">League:</label>
      <select id="league-select">
        <option value="all" selected>All</option>
        {% for league_code in leagues %}
          <option value="{{ league_code }}">
            {{ league_code }}
          </option>
        {% endfor %}
      </select>

      <label for="week-select">Week:</label>
      <select id="week-select">
        <option value="all" selected>All</option>
        {% for w in weeks %}
          <option value="{{ w }}">{{ w }}</option>
        {% endfor %}
      </select>

      <label for="high-conf">
        <input type="checkbox" id="high-conf">
        High Confidence
      </label>
    </div>
  </header>

  <!-- Cards Container -->
  <div class="cards-container" id="results-container">
    {% if results is not none and results.shape[0] > 0 %}
      {% for idx, p in results.iterrows() %}
        {# 
          Let's color-code the card if BetCorrect = True => green border, else red.
          We'll do it with a simple check for "correct" or "wrong".
        #}
        {% set correctness_class = 'correct' if p['BetCorrect'] else 'wrong' %}

        <div 
          class="prediction-card {{ correctness_class }}"
          data-league="{{ p['Div'] }}"
          data-highconf="{{ p['High_conf'] }}"
          data-week="{{ p['Week'] }}"
        >
          <!-- Top row: Date, Weekday, Time -->
          <div class="card-top">
            <span>
              {# 'Weekday' is a column in your CSV? If not, remove or adapt #}
              {% if 'Weekday' in p and p['Weekday'] %}
                {{ p['Weekday'] }}
              {% endif %}
              {% if p['Date'] %}
                {{ p['Date'].strftime('%d.%m.%Y') }}
              {% endif %}
              {% if 'Time' in p and p['Time'] %}
                {{ p['Time'] }}
              {% endif %}
            </span>
          </div>

          <!-- Middle: HomeTeam vs. AwayTeam -->
          <div class="card-middle">
            <div class="matchup">
              <span>{{ p['HomeTeam'] }} vs. {{ p['AwayTeam'] }}</span>
            </div>

            <!-- Final Bet + Probability + Correctness -->
            <div class="prediction-info">
              {% set predicted_bet = p['FinalBet'] %}
              {# Decide an odd & probability for display #}
              {% set predicted_odd = 0 %}
              {% set predicted_prob = 0 %}

              {% if predicted_bet == 'H' %}
                {% set predicted_odd = p['B365H'] if 'B365H' in p else 0 %}
                {% set predicted_prob = p['Prob_H'] if 'Prob_H' in p else 0 %}
              {% elif predicted_bet == 'D' %}
                {% set predicted_odd = p['B365D'] if 'B365D' in p else 0 %}
                {% set predicted_prob = p['Prob_D'] if 'Prob_D' in p else 0 %}
              {% elif predicted_bet == 'A' %}
                {% set predicted_odd = p['B365A'] if 'B365A' in p else 0 %}
                {% set predicted_prob = p['Prob_A'] if 'Prob_A' in p else 0 %}
              {% elif predicted_bet == '1X' %}
                {% set predicted_odd = p['1X_odds'] if '1X_odds' in p else 0 %}
                {% set predicted_prob = p['1X_prob'] if '1X_prob' in p else 0 %}
              {% elif predicted_bet == 'X2' %}
                {% set predicted_odd = p['X2_odds'] if 'X2_odds' in p else 0 %}
                {% set predicted_prob = p['X2_prob'] if 'X2_prob' in p else 0 %}
              {% endif %}

              Prediction: 
              <span class="highlight">
                {{ predicted_bet }} - {{ predicted_odd }}
              </span>
              <br>
              Confidence: 
              <span class="highlight">
                {{ (predicted_prob * 100) | round(1) }}%
              </span>
              <br>
              Actual Result:
              <span class="highlight">
                {{ p['Actual_Result'] if 'Actual_Result' in p else '' }}
                {% if 'Score' in p and p['Score'] %}
                  ({{ p['Score'] }})
                {% endif %}
              </span>
              <br>
              Correct?
              <span 
                class="highlight"
                style="color: {% if p['BetCorrect'] %} #2ecc71 {% else %} #e74c3c {% endif %};"
              >
                {% if p['BetCorrect'] %}Yes{% else %}No{% endif %}
              </span>
            </div>
          </div>

        </div>
      {% endfor %}
    {% else %}
      <p>No results found.</p>
    {% endif %}
  </div>

  <!-- JS for filtering by league, week, and high confidence -->
  <script>
    const leagueSelect = document.getElementById('league-select');
    const weekSelect = document.getElementById('week-select');
    const highConfCheckbox = document.getElementById('high-conf');
    const cards = document.querySelectorAll('.prediction-card');

    function filterResults() {
      const selectedLeague = leagueSelect.value;  // e.g. "D1"
      const selectedWeek = weekSelect.value;
      const highConfOnly = highConfCheckbox.checked;

      cards.forEach(card => {
        const cardLeague = card.getAttribute('data-league');
        const cardWeek = card.getAttribute('data-week');
        const cardHighConf = card.getAttribute('data-highconf'); // "0" or "1"

        let show = true;

        // Filter league
        if (selectedLeague !== 'all' && cardLeague !== selectedLeague) {
          show = false;
        }

        // Filter week
        if (selectedWeek !== 'all' && cardWeek !== selectedWeek) {
          show = false;
        }

        // Filter high conf
        if (highConfOnly && cardHighConf !== '1') {
          show = false;
        }

        card.style.display = show ? 'block' : 'none';
      });
    }

    leagueSelect.addEventListener('change', filterResults);
    weekSelect.addEventListener('change', filterResults);
    highConfCheckbox.addEventListener('change', filterResults);

    // Initial filter on page load
    filterResults();
  </script>
</body>
</html>
