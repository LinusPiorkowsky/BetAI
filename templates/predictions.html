<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ML Bets - Predictions</title>
  <!-- Link to your CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <!-- Navbar -->
  <nav>
    <div class="nav-left">Machine Learning Bets</div>
    <div class="nav-right">
      <a href="{{ url_for('index') }}">Home</a>
      <a href="{{ url_for('predictions') }}">Predictions</a>
      <a href="{{ url_for('results') }}">Results</a>
      <a href="{{ url_for('informations') }}">FAQ</a>
    </div>
  </nav>

  <!-- Page header -->
  <header>
    <h1>Upcomming Predictions</h1>
    <p class="date-range">
      {% if date_range %}
        {{ date_range }}
      {% else %}
        <div style="text-align: center; width: 100%;">No predictions available</div>
      {% endif %}
    </p>

    <!-- Filter section -->
    <div class="filters">
      <label for="league-select">League:</label>
      <select id="league-select">
        <option value="all">All</option>
        {% for league_code in leagues %}
          <option value="{{ league_code }}">
            {{ leagues_dict.get(league_code, league_code) }}
          </option>
        {% endfor %}
      </select>

      <label for="high-conf">
        <input type="checkbox" id="high-conf">
        High Confidence Predictions
        {#<span class="tooltip" data-tooltip="High Confidence means that the prediction has a high probability of being correct.">?</span> #}
      </label>
    </div>
  </header>

  <!-- Cards container -->
  <div class="cards-container" id="predictions-container">
    {% if predictions %}
      {% for p in predictions %}
        {# Determine the predicted team, probability, and odds based on "Prediction" #}
        {% set predicted_team = '' %}
        {% set predicted_prob = 0 %}
        {% set predicted_odd = 0 %}

        {% if p['Prediction'] == 'H' %}
          {% set predicted_team = p['HomeTeam'] %}
          {% set predicted_prob = p['Prob_H'] %}
          {% if p['Prob_H'] <= 0,6 %}
            {% set predicted_odd = p['1X_odds'] %}
            {% set predicted_bet = '1X' %}
            {% set predicted_prob2 = p['1X_prob'] %}
          {% else %}
            {% set predicted_odd = p['B365H'] %}
            {% set predicted_bet = p['HomeTeam'] %}
            {% set predicted_prob2 = p['Prob_H'] %}
          {% endif %}
        {% elif p['Prediction'] == 'D' %}
          {% set predicted_team = 'Draw' %}
          {% set predicted_prob = p['Prob_D'] %}
          {% if p['Prob_H'] + p['Prob_D'] > p['Prob_D'] + p['Prob_A'] %}
            {% set predicted_bet = '1X'  %}
            {% set predicted_prob2 = p['1X_prob'] %}
            {% set predicted_odd = p['1X_odds'] %}
          {% else %}
            {% set predicted_bet = 'X2'  %}
            {% set predicted_prob2 = p['X2_prob'] %}
            {% set predicted_odd = p['X2_odds'] %}
          {% endif %}
        {% elif p['Prediction'] == 'A' %}
          {% set predicted_team = p['AwayTeam'] %}
          {% set predicted_prob = p['Prob_A'] %}
          {% if p['High_conf'] == 1 %}
            {% set predicted_bet = p['AwayTeam'] %}
            {% set predicted_prob2 = p['Prob_A'] %}
            {% set predicted_odd = p['B365A'] %}
          {% else %}
            {% set predicted_bet = 'X2' %}
            {% set predicted_prob2 = p['X2_prob'] %}
            {% set predicted_odd = p['X2_odds'] %}
          {% endif %}
        {% endif %}

        <div 
          class="prediction-card"
          data-league="{{ p['Div'] }}"
          data-highconf="{{ p['High_conf'] }}"  {# e.g. 1 or 0, True/False etc. #}
        >
          <!-- Top row: Date, Weekday, Time -->
          <div class="card-top">
            <!-- Make sure Date is already a datetime in your Python code; otherwise parse carefully -->
            <span>{{ p['Weekday'] }} {{ p['Date'].strftime('%d.%m.%Y') }} {{ p['Time'] }}</span>
          </div>

          <!-- Middle: HomeTeam vs. AwayTeam -->
          <div class="card-middle">
            <div class="matchup">
              <span>{{ p['HomeTeam'] }} vs. {{ p['AwayTeam'] }}</span>
            </div>
            <!-- Predicted Team + Probability + Odd -->
            <div class="prediction-info">
              Prediction: <span class="highlight">{{ predicted_bet }} - {{ predicted_odd }}</span>
              <br>
              Confidence:: <span class="highlight"> {{ (predicted_prob2 * 100) | round(1) }}%</span>
            </div>
          </div>

          <!-- Bottom: All Odds -->
          <div class="card-bottom">
            <br>
            <span>1X: {{ p['1X_odds'] }} | X2: {{ p['X2_odds'] }}</span>
            <br>
            <span>{{ p['HomeTeam'] }}: {{ p['B365H'] }} | Draw: {{ p['B365D'] }} | {{ p['AwayTeam'] }}: {{ p['B365A'] }}</span>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p style="text-align: center; width: 100%;">New Predictions Friday 6pm</p>
    {% endif %}
  </div>

  <!-- Optional JavaScript for front-end filtering -->
  <script>
    const leagueSelect = document.getElementById('league-select');
    const highConfCheckbox = document.getElementById('high-conf');
    const cards = document.querySelectorAll('.prediction-card');

    function filterPredictions() {
      const selectedLeague = leagueSelect.value;
      const highConfOnly = highConfCheckbox.checked;

      cards.forEach(card => {
        const cardLeague = card.getAttribute('data-league');
        const cardHighConf = card.getAttribute('data-highconf');

        let showCard = true;

        // Filter by league if not "all"
        if (selectedLeague !== 'all' && cardLeague !== selectedLeague) {
          showCard = false;
        }

        // Filter by high confidence if checked
        // (Adjust check based on how "High_conf" is stored: '1'/'0', 'True'/'False', etc.)
        if (highConfOnly && cardHighConf !== '1') {
          showCard = false;
        }

        card.style.display = showCard ? 'block' : 'none';
      });
    }

    // Ensure high confidence checkbox is always checked
    highConfCheckbox.checked = true;

    leagueSelect.addEventListener('change', filterPredictions);
    highConfCheckbox.addEventListener('change', filterPredictions);

    // Initial filter on page load
    filterPredictions();
  </script>

  <!-- Footer -->
  <footer>
    <div class="footer-content">
      <p>&copy; 2025 Machine Learning Bets. All rights reserved.</p>
      <p>Disclaimer: This website is for educational purposes only. Please gamble responsibly.</p>
      <p>Contact: machinelearningbets@gmail.com</p>
    </div>
  </footer>

  <style>
    footer {
      background-color: #222;
      color: white;
      text-align: center;
      padding: 15px;
      margin-top: 30px;
    }
    .footer-links a {
      color: #ddd;
      text-decoration: none;
      margin: 0 10px;
    }
    .footer-links a:hover {
      color: #fff;
    }
  </style>
</body>
</html>
