<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ML Bets - Results</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
</head>
<body>
  <!-- Navbar -->
  <nav>
    <div class="nav-left">Machine Learning Bets</div>
    <div class="nav-right">
      <a href="{{ url_for('index') }}">Home</a>
      <a href="{{ url_for('predictions') }}">Predictions</a>
      <a href="{{ url_for('results') }}">Results</a>
      <a href="{{ url_for('informations') }}">FAQ</a>
    </div>
  </nav>

  <!-- Header / Filter Section -->
  <header>
    <h1>Results</h1>

        <!-- Summary Stats -->
    <div class="stats-summary">
      <div class="stat-box">
        <span class="stat-value">{{ total_bets }}</span>
        <span class="stat-label">Total Bets</span>
      </div>
      <div class="stat-box">
        <span class="stat-value">{{ correct_bets }}</span>
        <span class="stat-label">Correct</span>
      </div>
      <div class="stat-box">
        <span class="stat-value">{{ accuracy }}%</span>
        <span class="stat-label">Accuracy</span>
      </div>
    </div>

    <!-- Filters -->
    <form method="get" action="{{ url_for('results') }}" id="filter-form" class="filters">
      <label for="league">League:</label>
      <select id="league" name="league" onchange="this.form.submit()">
        <option value="">All</option>
        {% for league_code in leagues %}
          <option value="{{ league_code }}" {% if selected_league == league_code %}selected{% endif %}>
            {{ league_names.get(league_code, league_code) }}
          </option>
        {% endfor %}
      </select>

      <label for="week">Week:</label>
      <select id="week" name="week" onchange="this.form.submit()">
        <option value="">All</option>
        {% for w in weeks %}
          <option value="{{ w }}" {% if selected_week|string == w|string %}selected{% endif %}>{{ w }}</option>
        {% endfor %}
      </select>

      <label for="high_conf">
        <input type="checkbox" id="high_conf" name="high_conf" value="true" {% if high_conf_only %}checked{% endif %} onchange="this.form.submit()">
        High Confidence Predictions
      </label>
    </form>

  </header>

  <!-- Cards Container -->
  <div class="cards-container" id="results-container">
    {% if results is not none and results.shape[0] > 0 %}
      {% for idx, p in results.iterrows() %}
        {#
          Color-code card if BetCorrect = True => green, else red
        #}
        {% set correctness_class = 'correct' if p['BetCorrect'] else 'wrong' %}

        <div
          class="prediction-card {{ correctness_class }}"
          data-league="{{ p['Div'] }}"
          data-highconf="{{ p['High_conf'] }}"
          data-week="{{ p['Week'] }}"
        >
          <!-- Top row: Date, Weekday, Time -->
          <div class="card-top">
            <span>
              {% if 'Weekday' in p and p['Weekday'] %}
                {{ p['Weekday'] }}
              {% endif %}
              {% if p['Date'] %}
                {{ p['Date'].strftime('%d.%m.%Y') }}
              {% endif %}
            </span>
          </div>

          <!-- Middle: HomeTeam vs. AwayTeam -->
          <div class="card-middle">
            <div class="matchup">
              <span>{{ p['HomeTeam'] }} vs. {{ p['AwayTeam'] }}</span>
            </div>

            <!-- Show the final bet, final odd, confidence, etc. -->
            <div class="prediction-info">
              {% set final_bet = p['FinalBet'] %}
              {% set predicted_odd = 0 %}
              {% set predicted_prob = 0 %}

              {#
                Decide final odd and final probability
                based on the actual final bet
              #}
              {% if final_bet == 'H' %}
                {% set final_bet = p['HomeTeam'] %}
                {% set predicted_odd = p['B365H'] if 'B365H' in p else 0 %}
                {% set predicted_prob = p['Prob_H'] %}
              {% elif final_bet == '1X' %}
                {% set final_bet = p['HomeTeam'] + '/ Draw' %}
                {% set predicted_odd = p['1X_odds'] if '1X_odds' in p else 0 %}
                {% set predicted_prob = p['Prob_H'] + p['Prob_D'] - 0.1  %}
              {% elif final_bet == 'A' %}
                {% set final_bet = p['AwayTeam'] %}
                {% set predicted_odd = p['B365A'] if 'B365A' in p else 0 %}
                {% set predicted_prob = p['Prob_A'] %}
              {% elif final_bet == 'X2' %}
                {% set final_bet = p['AwayTeam'] + '/ Draw' %}
                {% set predicted_odd = p['X2_odds'] if 'X2_odds' in p else 0 %}
                {% set predicted_prob = p['Prob_D'] + p['Prob_A'] - 0.1 %}
              {% else %}
                {# Fallback if FinalBet is None or unknown #}
                {% set final_bet = '??' %}
                {% set predicted_odd = 0 %}
                {% set predicted_prob = 0 %}
              {% endif %}

              <!-- Output the final values -->
              <p>
                Prediction:
                <span class="highlight">
                  {{ final_bet }} - {{ predicted_odd }}
                </span>
              </p>
              <p>
                Confidence:
                <span class="highlight">
                  {{ (predicted_prob * 100)|round(1) }}%
                </span>
              </p>
              <p>
                Result:
                <span class="highlight">
                  {% if 'Score' in p and p['Score'] %}
                    {{ p['Score'] }}
                  {% else %}
                    (No Score)
                  {% endif %}
                </span>
              </p>
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p>No results found.</p>
    {% endif %}
  </div>

  <!-- JavaScript for client-side filtering -->
  <script>
    const leagueSelect = document.getElementById('league');
    const weekSelect = document.getElementById('week');
    const highConfCheckbox = document.getElementById('high_conf');
    const filterForm = document.getElementById('filter-form');
    const cards = document.querySelectorAll('.prediction-card');

    // Client-side filtering for immediate visual response
    function filterResults() {
      const selectedLeague = leagueSelect.value;
      const selectedWeek = weekSelect.value;
      const highConfOnly = highConfCheckbox.checked;

      cards.forEach(card => {
        const cardLeague = card.getAttribute('data-league');
        const cardWeek = card.getAttribute('data-week');
        const cardHighConf = card.getAttribute('data-highconf');

        let show = true;

        // Filter by league
        if (selectedLeague !== '' && cardLeague !== selectedLeague) {
          show = false;
        }

        // Filter by week
        if (selectedWeek !== '' && cardWeek !== selectedWeek) {
          show = false;
        }

        // Filter by high confidence
        if (highConfOnly && cardHighConf !== '1') {
          show = false;
        }

        card.style.display = show ? 'block' : 'none';
      });
    }

    // Set initial state based on URL params or defaults
    {% if high_conf_only %}
    highConfCheckbox.checked = true;
    {% endif %}

    // Initial filter on page load (client-side filtering)
    filterResults();
  </script>

  <!-- CSS for styling -->
  <style>
    .filters {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }

    .stats-summary {
      display: flex;
      justify-content: space-around;
      margin: 20px auto;
      background-color: #f9f9f9;
      padding: 15px;
      border-radius: 8px;
      width: 90%;
    }

    .stat-box {
      text-align: center;
    }

    .stat-value {
      display: block;
      font-size: 24px;
      font-weight: bold;
      color: #333;
    }

    .stat-label {
      font-size: 14px;
      color: #666;
    }
  </style>

  <!-- Footer -->
  <footer>
    <div class="footer-content">
      <p>&copy; 2025 Machine Learning Bets</p>
      <p>This website is for educational purposes only</p>
      <p>No Prediction is guaranteed</p>
      <p>Contact: machinelearningbets@gmail.com</p>

      <!-- Social Media Links -->
      <div class="footer-links">
        <a href="https://x.com/MLearningBets" target="_blank">
          <img src="static/icons/x.png" alt="X" class="social-icon">
        </a>
        <a href="https://www.tiktok.com/@machinelearningtipps" target="_blank">
          <img src="static/icons/tiktok.png" alt="TikTok" class="social-icon">
        </a>
        <a href="https://www.instagram.com/machinelearningbets" target="_blank">
          <img src="static/icons/instagram.png" alt="Instagram" class="social-icon">
        </a>
      </div>
    </div>
  </footer>

  <style>
    footer {
      background-color: #222;
      color: white;
      text-align: center;
      padding: 15px;
      margin-top: 30px;
      width: auto;
    }
    .footer-links a {
      color: #ddd;
      text-decoration: none;
      margin: 0 10px;
    }
    .footer-links a:hover {
      color: #fff;
    }
    .social-icon {
    width: 30px;  /* Adjust icon size */
    height: auto;
    transition: transform 0.2s ease-in-out;
    }
    .social-icon:hover {
    transform: scale(1.2); /* Slight zoom effect on hover */
    }
  </style>
</body>
</html>